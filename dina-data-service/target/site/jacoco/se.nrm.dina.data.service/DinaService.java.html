<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>DinaService.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">dina-data-service</a> &gt; <a href="index.source.html" class="el_package">se.nrm.dina.data.service</a> &gt; <span class="el_source">DinaService.java</span></div><h1>DinaService.java</h1><pre class="source lang-java linenums">/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package se.nrm.dina.data.service;
 
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List; 
import javax.ejb.EJB;
import javax.ejb.Stateless;
import javax.ws.rs.Consumes;
import javax.ws.rs.DELETE;
import javax.ws.rs.DefaultValue;
import javax.ws.rs.GET;
import javax.ws.rs.POST;
import javax.ws.rs.PUT;
import javax.ws.rs.Path;
import javax.ws.rs.PathParam;
import javax.ws.rs.Produces; 
import javax.ws.rs.QueryParam;
import javax.ws.rs.core.Context;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.MultivaluedMap;
import javax.ws.rs.core.Response;
import javax.ws.rs.core.UriInfo;
import org.apache.commons.lang.StringUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import se.nrm.dina.data.exceptions.DinaException; 
import se.nrm.dina.data.logic.DinaDataLogic;
 
/**
 *
 * @author idali
 */
@Path(&quot;/dina/v0&quot;)
@Consumes({MediaType.APPLICATION_JSON+&quot;;charset=UTF-8&quot;})
@Produces({MediaType.APPLICATION_JSON+&quot;;charset=UTF-8&quot;}) 
@Stateless
public class DinaService {

<span class="fc" id="L44">    private final Logger logger = LoggerFactory.getLogger(this.getClass());</span>

    @EJB
    private DinaDataLogic logic;
    
<span class="fc" id="L49">    public DinaService() {</span>
        
<span class="fc" id="L51">    }</span>
    
<span class="fc" id="L53">    public DinaService(DinaDataLogic logic) {</span>
<span class="fc" id="L54">        this.logic = logic;</span>
<span class="fc" id="L55">    }</span>
    
    @GET
    @Path(&quot;{entity}&quot;) 
    public Response getAllByEntityName (@PathParam(&quot;entity&quot;) String entity, 
                                        @QueryParam(&quot;offset&quot;) int offset, 
                                        @DefaultValue(&quot;50&quot;) @QueryParam(&quot;limit&quot;) int limit, 
                                        @DefaultValue(&quot;0&quot;) @QueryParam(&quot;minid&quot;) int minid,
                                        @DefaultValue(&quot;0&quot;) @QueryParam(&quot;maxid&quot;) int maxid,
                                        @QueryParam(&quot;orderby&quot;) String orderby) {
        
<span class="fc" id="L66">        logger.info(&quot;getAllByEntityName : {} -- {}&quot;, entity, offset + &quot; -- &quot; + limit);    </span>
        
<span class="fc" id="L68">        List&lt;String&gt; sort = new ArrayList();</span>
<span class="fc bfc" id="L69" title="All 2 branches covered.">        if(orderby != null) {</span>
<span class="fc" id="L70">            sort = Arrays.asList(StringUtils.split(orderby, &quot;,&quot;));</span>
        }
      
        try {   
<span class="fc" id="L74">            return Response.ok(logic.findAll(entity, offset, limit, minid, maxid, sort, null))</span>
<span class="fc" id="L75">                    .header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)</span>
<span class="fc" id="L76">                    .build();</span>
<span class="fc" id="L77">        } catch(DinaException e) {</span>
<span class="fc" id="L78">            return Response.status(e.getErrorCode())</span>
<span class="fc" id="L79">                    .header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)</span>
<span class="fc" id="L80">                    .entity(e.getMessage())</span>
<span class="fc" id="L81">                    .build();</span>
        }   
    }
     
    @GET
    @Path(&quot;{entity}/search&quot;)  
    public Response getData(@PathParam(&quot;entity&quot;) String entity, @Context UriInfo info) {

<span class="fc" id="L89">        MultivaluedMap&lt;String, String&gt; map = info.getQueryParameters(); </span>

        try {  
<span class="fc" id="L92">            return Response.ok(logic.findAllBySearchCriteria(entity, map))</span>
<span class="fc" id="L93">                    .header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)</span>
<span class="fc" id="L94">                    .build();  </span>
<span class="fc" id="L95">        } catch(DinaException e) {</span>
<span class="fc" id="L96">            return Response.status(e.getErrorCode())</span>
<span class="fc" id="L97">                    .header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)</span>
<span class="fc" id="L98">                    .entity(e.getMessage())</span>
<span class="fc" id="L99">                    .build();</span>
        }  
    } 
        
    /**
     * Generic method to get an entity by entity id from database.  
     * This method passes in a PathParam entity class name and entity id 
     * 
     * @param entity - class name of the entity
     * @param id - entity id
     * 
     * @return entity 
     */
    @GET
    @Path(&quot;{entity}/{id}/&quot;) 
    public Response getEntityById(@PathParam(&quot;entity&quot;) String entity, @PathParam(&quot;id&quot;) String id) {
        
<span class="fc" id="L116">        logger.info(&quot;getEntityById - entity: {}, id :  {}&quot;, entity, id);</span>
   
        try {     
<span class="fc" id="L119">            return Response.ok(logic.findById(id, entity))</span>
<span class="fc" id="L120">                    .header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)</span>
<span class="fc" id="L121">                    .build(); </span>
<span class="fc" id="L122">        } catch (DinaException e) {</span>
<span class="fc" id="L123">            return Response.status(e.getErrorCode())</span>
<span class="fc" id="L124">                    .header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)</span>
<span class="fc" id="L125">                    .entity(e.getMessage())</span>
<span class="fc" id="L126">                    .build();</span>
        }
    }


    /**
     * Generic method to get an entity by entity id from database.  
     * This method passes in a PathParam entity class name and entity id 
     * 
     * @param entity - class name of the entity 
     * 
     * @return entity 
     */
    @GET
    @Path(&quot;{entity}/count&quot;)  
    public Response getEntityCount(@PathParam(&quot;entity&quot;) String entity ) {
        
<span class="fc" id="L143">        logger.info(&quot;getEntityById - entity: {} &quot;, entity );</span>

        try {  
<span class="fc" id="L146">            int count = logic.findEntityCount(entity); </span>
              
<span class="fc" id="L148">            return Response.ok(String.valueOf(count))</span>
<span class="fc" id="L149">                    .header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;).build(); </span>
<span class="fc" id="L150">        } catch(DinaException e) { </span>
<span class="fc" id="L151">            return Response.status(e.getErrorCode())</span>
<span class="fc" id="L152">                    .header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)</span>
<span class="fc" id="L153">                    .entity(e.getMessage())</span>
<span class="fc" id="L154">                    .build();</span>
        }  
    } 

    /**
     * Generic method to create an entity by passing SpecifyBeanWrapper, the
     * entity to be created is wrapped into SpecifyBeanWrapper
     *
     * @param entity
     * @param json 
     * @return  Response
     *
     */
    @POST
    @Path(&quot;{entity}&quot;)
    @Consumes(&quot;application/json&quot;)
    public Response createNewEntity(@PathParam(&quot;entity&quot;) String entity, String json) {
<span class="fc" id="L171">        logger.info(&quot;createNewEntity - entity: {}&quot;, json);</span>
 
        try {  
<span class="fc" id="L174">            return Response.ok(logic.createEntity(entity, json))</span>
<span class="fc" id="L175">                    .header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)</span>
<span class="fc" id="L176">                    .build();</span>
<span class="fc" id="L177">         } catch(DinaException e) { </span>
<span class="fc" id="L178">            return Response.status(e.getErrorCode())</span>
<span class="fc" id="L179">                    .header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)</span>
<span class="fc" id="L180">                    .entity(e.getMessage())</span>
<span class="fc" id="L181">                    .build();</span>
        }  
    }

    /**
     * Generic method update an entity
     * 
     * @param entity
     * @param json 
     *
     * @return
     *
     */
    @PUT
    @Path(&quot;{entity}&quot;) 
    public Response updateEntity(@PathParam(&quot;entity&quot;) String entity, String json) {
    
<span class="fc" id="L198">        logger.info(&quot;update entity: {} -- {}&quot;, entity, json);</span>
        
         try {  
<span class="fc" id="L201">            return Response.ok(logic.updateEntity(entity, json))</span>
<span class="fc" id="L202">                    .header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)</span>
<span class="fc" id="L203">                    .build(); </span>
<span class="fc" id="L204">         } catch(DinaException e) { </span>
<span class="fc" id="L205">            return Response.status(e.getErrorCode())</span>
<span class="fc" id="L206">                    .header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)</span>
<span class="fc" id="L207">                    .entity(e.getMessage())</span>
<span class="fc" id="L208">                    .build();</span>
        }  
    }
      
    /**
     * Generic method to delete an entity by entity id from database.  
     * This method passes in a PathParam entity class name and entity id 
     * 
     * @param entity - class name of the entity 
     * @param id 
     * 
     * @return entity 
     */
    @DELETE
    @Path(&quot;{entity}/{id}&quot;)  
    public Response deleteEntityById(@PathParam(&quot;entity&quot;) String entity, @PathParam(&quot;id&quot;) int id) {
        
<span class="fc" id="L225">        logger.info(&quot;deleteEntityById - entity -- id: {} -- {}&quot;, entity, id );</span>

        try {   
<span class="fc" id="L228">            logic.deleteEntity(entity, id);  </span>
<span class="fc" id="L229">            logger.info(&quot;OK&quot;);</span>
<span class="fc" id="L230">            return Response.ok().header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;).build();  </span>
<span class="fc" id="L231">        } catch(DinaException e) { </span>
<span class="fc" id="L232">            logger.error(&quot;not ok&quot;);</span>
<span class="fc" id="L233">            return Response.status(e.getErrorCode())</span>
<span class="fc" id="L234">                    .header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)</span>
<span class="fc" id="L235">                    .entity(e.getMessage())</span>
<span class="fc" id="L236">                    .build();</span>
        }  
    } 
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>